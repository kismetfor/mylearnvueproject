# 箭头函数（Arrow Function）——课堂笔记

> 本篇为本节课的整理笔记，包含语法、特性、常见用法与注意事项。代码示例均为 JavaScript（`.js`）。

---

## 一、概览

箭头函数是对传统函数表达的简写语法，引入了**隐式返回**与**词法 `this`** 的行为。适用于简短函数、回调和高阶函数场景，但并不完全替代普通函数（如需要构造器、动态 `this` 时不能用）。

---

## 二、基本语法

```js
// 完整形式（带函数体）
const add = (x, y) => {
  return x + y;
};

// 单表达式隐式返回（省略大括号与 return）
const add = (x, y) => x + y;
```

特点：

* 单参数可以省略小括号：`x => x * 2`
* 无参数写法：`() => 42`

---

## 三、返回对象字面量

直接返回对象时必须用圆括号包住对象字面量，否则 `{}` 会被解析为函数体：

```js
// 错误（会被当作函数体）
const f = () => { a: 1 };

// 正确（用小括号包起来）
const f = () => ({ a: 1 });
```

---

## 四、`this` / `arguments` / 不能用作构造函数

* 箭头函数**没有自己的 `this`**，`this` 从外层词法作用域继承（lexical `this`）。
* 箭头函数没有 `arguments`，如需访问参数列表用 rest：`(...args) => {}`。
* 不能作为构造函数（不能 `new`）。
* 不能用作 generator（没有 `function*` 特性）。

示例说明 `this` 行为差异：

```js
function TimerOld() {
  this.seconds = 0;
  setInterval(function () {
    // 普通函数：this 不指向 TimerOld 实例（取决于调用）
    this.seconds++;
  }, 1000);
}

function TimerNew() {
  this.seconds = 0;
  setInterval(() => {
    // 箭头函数：this 继承自 TimerNew 的上下文，指向实例
    this.seconds++;
  }, 1000);
}
```

---

## 五、常见用法（回调与数组方法）

箭头函数常用于回调与数组迭代方法：

```js
// 回调
setTimeout(() => console.log('time out!'), 2000);

// 数组高阶函数
[1,2,3].map(x => x * x);
users.filter(u => u.active).map(u => u.name);
```

---

## 六、常见坑 / 注意事项

* 把对象方法写成箭头函数通常会导致 `this` 指向外层而不是对象本身（谨慎使用）。
* 不能使用 `new`，也没有 `prototype`。
* 没有 `arguments`，需要 `...args`。
* 如果需要动态绑定 `this`（`call`/`apply`/`bind`）或需要函数原型，使用普通函数更稳妥。

---

## 七、示例（来自课堂代码）

```html
<script>
  // 简单示例：定时器回调
  setTimeout(() => console.log('time out!'), 2000);

  // 隐式返回与对象返回
  const state1 = () => ({ token: 'xxx', userInfo: { name: 'lihua', age: 18 } });
  console.log(state1());

  // 单参数省略括号
  const log = arg => console.log(arg);
  log(6666);

  // 单行隐式返回
  const add = (x, y) => x + y;
  console.log(add(1, 2));
</script>
```

---

## 八、课堂小结（记忆要点）

* 语法：`(params) => expr` 或 `(params) => { ... }`
* 单表达式自动返回，返回对象用 `() => ({})`
* 单参数可省略 `()`，无参数用 `()`
* 箭头函数没有自己的 `this`、`arguments`，不能 `new`

---

## 九、练习题（建议先自己做）

1. 把下面函数改成箭头函数（只写箭头版本）
   ```js
   function square(x) {
     return x * x;
   }
   ```
2. 改写：
   ```js
   function sum(a, b, c) {
     return a + b + c;
   }
   ```
3. 将下面对象的方法修正为能正确增加 `count`（提示：考虑 `this`）
   ```js
   const obj = {
     count: 0,
     inc: function() {
       setTimeout(function() {
         this.count++;
       }, 100);
     }
   };
   ```
4. 将函数改写为箭头并返回对象：
   ```js
   function makePair(a, b) {
     return { a: a, b: b };
   }
   ```
5. 将下面回调改成箭头写法：
   ```js
   [1,2,3,4].map(function(n, i) { return n * i; });
   ```
6. `arguments` 示例：改写下面函数为箭头并能打印所有参数
   ```js
   function logger() {
     console.log(arguments);
   }
   ```

---

需要我把这些练习的**参考答案**发给你吗？还是你先做完让我帮你批改（只指出错误）？
